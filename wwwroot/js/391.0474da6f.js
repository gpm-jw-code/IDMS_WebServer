"use strict";(self["webpackChunkgpm_admin"]=self["webpackChunkgpm_admin"]||[]).push([[391],{2391:function(e,t,s){s.r(t),s.d(t,{default:function(){return B}});var l=s(3396);const i={class:"fade-in bg-light"},a={class:"row g-1"};function n(e,t,s,n,o,d){const r=(0,l.up)("status-card-vue");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l._)("div",a,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.veData,((e,t)=>((0,l.wg)(),(0,l.j4)(r,{edge_ip:o.edge_ip,class:"col-md-4",key:t,ip:t,veData:e},null,8,["edge_ip","ip","veData"])))),128))])])}var o=s(7139);const d={class:"ve-module-status d-flex flex-column px-1 py-1"},r={class:"bg-dark"},u={class:"info d-flex flex-row px-2 py-2"},c={class:"flex-fill d-flex justify-content-start"},h=(0,l._)("span",null,"EQ :",-1),g=(0,l._)("span",null,"UNIT :",-1),p={class:""},w={class:"d-flex flex-row justify-content-center py-2"},v={class:"ve-value"},_=(0,l.Uk)("ENTER");function f(e,t,s,i,a,n){const f=(0,l.up)("CircleCheck"),m=(0,l.up)("Warning"),S=(0,l.up)("el-icon"),k=(0,l.up)("CircleCheckFilled"),y=(0,l.up)("WarningFilled"),C=(0,l.up)("b-button"),x=(0,l.up)("DetailViewVue");return(0,l.wg)(),(0,l.iD)("div",d,[(0,l._)("div",r,[(0,l._)("div",u,[(0,l._)("div",c,[h,(0,l._)("span",null,(0,o.zw)(s.veData.EqName),1),g,(0,l._)("span",null,(0,o.zw)(s.veData.UnitName),1)]),(0,l._)("div",p,[(0,l._)("span",null,(0,o.zw)(s.ip),1),(0,l.Wm)(S,{size:"18px"},{default:(0,l.w5)((()=>[a.Connected?((0,l.wg)(),(0,l.j4)(f,{key:0})):((0,l.wg)(),(0,l.j4)(m,{key:1}))])),_:1})])]),(0,l._)("div",w,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.veData.AxisStatus,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"axis-status",key:t},[(0,l._)("span",null,(0,o.zw)(t),1),(0,l._)("div",{class:(0,o.C_)(["icon",e.IsOutOfSPC?"ve-warning":"ve-normal"])},[(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[e.IsOutOfSPC?((0,l.wg)(),(0,l.j4)(y,{key:1})):((0,l.wg)(),(0,l.j4)(k,{key:0}))])),_:2},1024),(0,l._)("span",v,(0,o.zw)(e.veValue.toFixed(3)),1)],2)])))),128))]),(0,l._)("div",null,[(0,l.Wm)(C,{onClick:n.EnterHandle,class:"w-100",variant:"dark"},{default:(0,l.w5)((()=>[_])),_:1},8,["onClick"])]),(0,l.Wm)(x,{ref:"detail_view",edge_ip:s.edge_ip,ip:s.ip},null,8,["edge_ip","ip"])])])}var m=s(9242);const S=["id"],k={class:"flex-fill"},y={class:"h-100 w-100"},C={class:"axis-title d-flex justify-content-start w-100 px-3"},x={class:"content d-flex flex-row justify-content-start h-100 row"},D={class:"flex-fill"},T={class:"threshold-setting w-100"},$={class:"d-flex flex-row"},W={key:0},b=(0,l._)("span",null,"UCL",-1),U=["value"],H=(0,l._)("span",null,"LCL",-1),V=["value"],z={key:1,class:"setting-mode"},E=(0,l._)("span",null,"UCL",-1),N=["value","onChange","onKeyup"],j=(0,l._)("span",null,"LCL",-1),I=["value","onChange","onKeyup"],A=(0,l.Uk)("Unlock"),O=(0,l.Uk)("儲存"),Z=(0,l.Uk)("取消"),Y={class:"charting flex-fill col-md-6"};function F(e,t,s,i,a,n){const d=(0,l.up)("el-button"),r=(0,l.up)("GPMChart"),u=(0,l.up)("el-drawer"),c=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.j4)(u,{direction:"btt",size:"92%",modelValue:a.show,"onUpdate:modelValue":t[1]||(t[1]=e=>a.show=e),onClosed:n.CloseHandle,"show-close":!1},{header:(0,l.w5)((({titleId:e})=>[(0,l._)("div",{id:e,class:"ve-detail-title d-flex flex-row"},[(0,l._)("div",k,(0,o.zw)(`振動能量-${a.veData.EqName}/${a.veData.UnitName}(${s.ip})`),1),(0,l.Wm)(d,{size:"large",plain:"",icon:"close",circle:"",onClick:t[0]||(t[0]=e=>a.show=!1)})],8,S)])),default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",y,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.veData.AxisStatus,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"axis-infos d-flex flex-column",key:t},[(0,l._)("div",C,(0,o.zw)(t)+" 軸向",1),(0,l._)("div",x,[(0,l._)("div",{class:"value-display d-flex flex-column col-md-3 bg-dark",style:(0,o.j5)({color:e.IsOutOfSPC?"red":"rgb(0, 255, 0)"})},[(0,l._)("div",D,(0,o.zw)(e.veValue.toFixed(3)),1),(0,l._)("div",T,[(0,l._)("div",$,[a.ThresholdSettinglock[t]?((0,l.wg)(),(0,l.iD)("div",W,[b,(0,l._)("input",{disabled:"",value:e.ucl,type:"number",step:"0.01"},null,8,U),H,(0,l._)("input",{disabled:"",value:e.lcl,type:"number",step:"0.01"},null,8,V)])):(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",z,[E,(0,l._)("input",{class:"setting-input",value:a.ThresholdSetting[t].ucl,type:"number",step:"0.01",onChange:e=>{a.ThresholdSetting[t].ucl=e.target.value},onKeyup:e=>{a.ThresholdSetting[t].ucl=e.target.value}},null,40,N),j,(0,l._)("input",{class:"setting-input",value:a.ThresholdSetting[t].lcl,type:"number",step:"0.01",onChange:e=>{a.ThresholdSetting[t].lcl=e.target.value},onKeyup:e=>{a.ThresholdSetting[t].lcl=e.target.value}},null,40,I)])),[[c,a.ThresholdSetting[t].loading]]),(0,l.wy)((0,l.Wm)(d,{size:"small",onClick:e=>n.UnlockClickHandle(t)},{default:(0,l.w5)((()=>[A])),_:2},1032,["onClick"]),[[m.F8,a.ThresholdSettinglock[t]]]),(0,l.wy)((0,l.Wm)(d,{size:"small",onClick:e=>n.SettingThersHoldHandle(t)},{default:(0,l.w5)((()=>[O])),_:2},1032,["onClick"]),[[m.F8,!a.ThresholdSettinglock[t]]]),(0,l.wy)((0,l.Wm)(d,{size:"small",onClick:e=>a.ThresholdSettinglock[t]=!0},{default:(0,l.w5)((()=>[Z])),_:2},1032,["onClick"]),[[m.F8,!a.ThresholdSettinglock[t]]])])])],4),(0,l._)("div",Y,[(0,l.Wm)(r,{class:"vechart",ref_for:!0,ref:n.chart_id+"_"+t,chart_id:n.chart_id+"_"+t,title:`[${t}]軸向振動能量趨勢圖`,yAxisLabel:"振動能量(G)"},null,8,["chart_id","title"])])])])))),128))])),[[c,!a.wsDataRecieved]])])),_:1},8,["modelValue","onClosed"])}var K=s(6045),L={components:{GPMChart:K.Z},props:{ip:{type:String,default:"123.213.213.23"},edge_ip:{type:String,default:"123.213.213.23"}},computed:{chart_id(){return this.ip+"_ve_detail_chart"}},data(){return{show:!1,wsDataRecieved:!1,ws:null,veData:{IP:"",EqName:"",UnitName:"",AxisStatus:{X:{status:"normal",veValue:0},Y:{status:"warning",veValue:0},Z:{status:"danger",veValue:0}}},ThresholdSettinglock:{X:!0,Y:!0,Z:!0},ThresholdSetting:{X:{ucl:1,lcl:1,loading:!1},Y:{ucl:1,lcl:1,loading:!1},Z:{ucl:1,lcl:1,loading:!1}}}},methods:{Show(){this.show=!0,this.WsIni()},UnlockClickHandle(e){let t=this.veData.AxisStatus[e].ucl,s=this.veData.AxisStatus[e].lcl;this.ThresholdSetting[e].ucl=t,this.ThresholdSetting[e].lcl=s,this.ThresholdSettinglock[e]=!1},SettingThersHoldHandle(e){this.ThresholdSetting[e].loading=!0,setTimeout((()=>{let t=new WebSocket(`ws://${this.edge_ip}:44332/VibrationEnergy/ThresholdSetting?ip=${this.ip}&axis=${e}&ucl=${this.ThresholdSetting[e].ucl}&lcl=${this.ThresholdSetting[e].lcl}`);t.onmessage=s=>{var l=JSON.parse(s.data);t.onmessage=null,t.close(),setTimeout((()=>{l.data?this.$toast.info(`${this.ip} ${e}軸閥值設定完成`):this.$toast.error(`${this.ip} ${e}軸閥值設定失敗!\r\n${l.message}`),this.ThresholdSettinglock[e]=!0,this.ThresholdSetting[e].loading=!1}),500)},t.onerror=t=>{this.$toast.error(`${this.ip} ${e}軸閥值設定失敗!\r\n${t.message}`),console.info("設定VE閥值時發生websocket error",t)}}),50)},WsIni(){this.ws=new WebSocket(`ws://${this.edge_ip}:44332/VibrationEnergy?ip=${this.ip}&type=charting`),this.ws.onmessage=e=>this.WsDataHandle(JSON.parse(e.data))},WsDataHandle(e){if(this.wsDataRecieved=!0,this.veData=e,this.show)try{this.$refs[this.chart_id+"_X"][0].UpdateChart(this.veData.AxisStatus.X.charting),this.$refs[this.chart_id+"_Y"][0].UpdateChart(this.veData.AxisStatus.Y.charting),this.$refs[this.chart_id+"_Z"][0].UpdateChart(this.veData.AxisStatus.Z.charting)}catch(t){console.error(t)}},CloseHandle(){null!=this.ws&&(this.ws.onmessage=null,this.ws.close()),this.wsDataRecieved=!1}},mounted(){}},P=s(89);const R=(0,P.Z)(L,[["render",F]]);var X=R,q={components:{DetailViewVue:X},props:{edge_ip:{type:String,default:"127.0.0.1"},ip:{type:String,default:"123.213.213.23"},veData:{type:Object,default(){return{IP:"",EqName:"",UnitName:"",AxisStatus:{X:{status:"normal"},Y:{status:"warning"},Z:{status:"danger"}}}}}},data(){return{Connected:!0}},methods:{EnterHandle(){this.$refs["detail_view"].Show()}}};const M=(0,P.Z)(q,[["render",f]]);var G=M,J={components:{StatusCardVue:G},data(){return{edge_ip:"",ws:null,wsConnecting:!1,veData:{}}},methods:{MessageDataHandle(e){this.veData=e},WsIni(){this.ws=new WebSocket(`ws://${this.edge_ip}:44332/VibrationEnergy`),this.ws.onmessage=e=>this.MessageDataHandle(JSON.parse(e.data)),this.ws.onclose=()=>this.WsRetry()},WsRetry(){this.wsConnecting=!0,this.WsDestory(),this.WsIni()},WsDestory(){null!=this.ws&&(this.ws.onmessage=null,this.ws.onclose=null)}},mounted(){this.WsIni()},created(){this.edge_ip=this.$route.params.ip},unmounted(){this.WsDestory()}};const Q=(0,P.Z)(J,[["render",n]]);var B=Q}}]);
//# sourceMappingURL=391.0474da6f.js.map